---

services:
  tsdproxy:
    image: almeidapaulopt/tsdproxy:latest
    container_name: tsdproxy
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - tsdproxydata:/data
    environment:
      - TSDPROXY_AUTHKEY=${TSDPROXY_AUTHKEY}
      - TSDPROXY_HOSTNAME=${TSDPROXY_HOSTNAME}
      - DOCKER_HOST=unix:///var/run/docker.sock
    restart: unless-stopped

  timemachine:
    image: mbentley/timemachine:smb
    container_name: time-machine
    labels:
      tsdproxy.enable: "true"
      tsdproxy.name: "timemachine"
    ports:
      - "137:137/udp"
      - "138:138/udp"
      - "139:139"
      - "445:445"
    environment:
      - SHARE_NAME=${SMB_NAME}
      - TM_GROUPNAME=${SMB_NAME}
      - TM_USERNAME=${SMB_USER}
      - PASSWORD=${SMB_PASSWORD}
      - TM_UID=1000
      - TM_GID=1000
      - SET_PERMISSIONS=false
      - VOLUME_SIZE_LIMIT=0
    restart: unless-stopped
    network_mode: host
    volumes:
      - /dev/sda1:/opt/timemachine
    tmpfs:
      - /run/samba
    ulimits:
      nofile:
        soft: 65536
        hard: 65536

volumes:
  tsdproxydata:
